<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Wallet</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="CCRTMainStyle.css">
    <link rel="stylesheet" href="CCRTPageStyle.css">

    <script>
 		
        var cards = [];
        var username = sessionStorage.getItem("username");

        function getAllCards() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status > 199) {
                    document.querySelectorAll("#cardTable tbody tr").forEach(function(e){e.remove()});

                    cards = JSON.parse(this.responseText);
                    let table = document.querySelector("#cardTable tbody");

                    for (let i = 0; i < cards.length; ++i) {
                        let row = table.insertRow(table.rows.length);

                        let idCell = row.insertCell(0); 
                        idCell.innerHTML = cards[i].creditCardID;

                        let nameCell = row.insertCell(1);
                        nameCell.innerHTML = cards[i].creditCardName;
                    }
                }
            };
            var getURL = "http://localhost:8080/CreditCardRewardTrackerWeb/tracker/CreditCardService/"+username+"/all";
            xhttp.open("GET", getURL , true);
            xhttp.send();
        }

        function submitCard() {
            let card = {};
            card.creditCardName = document.querySelector("#cardName").value;
        

            var req = new XMLHttpRequest();
            req.onreadystatechange = function() {
                if (this.readyState > 3) {
                    document.querySelector("#cardName").value = "";
                }
            }
            
            req.open("POST", "http://localhost:8080/CreditCardRewardTrackerWeb/tracker/CreditCardService/test2/new", true);
            req.setRequestHeader('Content-Type', 'application/json');
            req.send(JSON.stringify(card));
        }

        function deleteCard() {
            let card = {};
            card = document.querySelector("#cardID").value;
        

            var req = new XMLHttpRequest();
            req.onreadystatechange = function() {
                if (this.readyState > 3) {
                    document.querySelector("#cardID").value = "";
                }
            }
            
            req.open("DELETE", "http://localhost:8080/CreditCardRewardTrackerWeb/tracker/CreditCardService/test2/remove", true);
            req.setRequestHeader('Content-Type', 'application/json');
            req.send(JSON.stringify(card));
        }
 		
 	</script>

</head>
<header>
<!--Navigation bar adapted from: https://www.w3schools.com/bootstrap/bootstrap_navbar.asp-->
<nav class="navbar navbar-inverse">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="#">Credit Card Reward Tracker</a>
      </div>
        <div><a href="#">Home</a></div>
        <div><a href="addcard.html">Add Card</a></div>
        <div><a href="addtransaction.html">Add Transaction</a></div>
        <div class="active"><a href="managewallet.html">Manage Wallet</a></div>
        <div><a href="managereceipts.html">Manage Receipts</a></div>
        <div><a href="homepage.html">Log Out</a></div>
    </div>
  </nav>
</header>
<body>
    <table class="table table-striped table-hover" id="cardTable">
        <thead>
            <tr>
                <th>Card ID</th>
                <th>Card Name</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>
    <br/> <br/>
    <input type="button" onClick="getAllCards()" value="Get All Cards"/>
    <br/> <br/>
    <input type="text" id="cardName" />
    <input type="button" id="inpButton" value="Add Card" onClick="submitCard()"/>
    <input type="number" id="cardID" />
    <input type="button" id="inpButton" value="Delete Card" onClick="deleteCard()"/>
</body>
</html>